{% extends 'base.html' %}

{% block title %}æˆ‘çš„è®¢å• - PyShop{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">æˆ‘çš„è®¢å•</h2>

    {% if orders %}
    <div class="list-group">
        {% for order in orders %}
        <div class="list-group-item list-group-item-action mb-3 shadow-sm">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    è®¢å•ç¼–å·ï¼š{{ order.id }}
                    <span class="badge bg-{% if order.status == 'pending' %}warning{% elif order.status == 'paid' %}primary{% elif order.status == 'shipped' %}info{% elif order.status == 'delivered' %}success{% else %}danger{% endif %} ms-2">
                        {{ order.get_status_display }}
                    </span>
                </h5>
                <small class="text-muted">{{ order.created_at|date:"Y-m-d H:i" }}</small>
            </div>
            <div class="mt-2">
                <p class="mb-1">æ”¶è´§äººï¼š{{ order.full_name }} | ç”µè¯ï¼š{{ order.phone }}</p>
                <p class="mb-1">åœ°å€ï¼š{{ order.address }}</p>
                <p class="fw-bold mb-1">è®¢å•æ€»ä»·ï¼šÂ¥{{ order.total_price }}</p>
            </div>
            <div class="mt-3">
                <a href="{% url 'orders:order_detail' order.id %}" class="btn btn-sm btn-primary">æŸ¥çœ‹è¯¦æƒ…</a>
                {% if order.status == 'pending' %}
                <button class="btn btn-sm btn-success" onclick="updateStatus('{{ order.id }}', 'paid')">æ ‡è®°ä¸ºå·²ä»˜æ¬¾</button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- çŠ¶æ€æ›´æ–°è¡¨å•ï¼ˆéšè—ï¼Œé€šè¿‡JSæäº¤ï¼‰ -->
    <form id="statusForm" method="POST" style="display: none;">
        {% csrf_token %}
        <input type="hidden" name="status" id="statusInput">
    </form>
    {% else %}
    <div class="text-center py-5">
        <img src="https://via.placeholder.com/100x100?text=ğŸ“¦" alt="æ— è®¢å•" class="mb-3">
        <h4>æš‚æ— è®¢å•è®°å½•</h4>
        <p class="text-muted">å¿«å»ä¸‹å•å§ï½</p>
        <a href="{% url 'products:product_list' %}" class="btn btn-primary mt-2">å»è´­ç‰©</a>
    </div>
    {% endif %}
</div>

<script>
// è®¢å•çŠ¶æ€æ›´æ–°JS
function updateStatus(orderId, status) {
    const form = document.getElementById('statusForm');
    form.action = `/orders/update-status/${orderId}/`;
    document.getElementById('statusInput').value = status;
    form.submit();
}
</script>
{% endblock %}