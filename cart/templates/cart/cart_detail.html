<!--è´­ç‰©è½¦è¯¦æƒ…æ¨¡æ¿-->

{% extends 'base.html' %} <!-- ç»§æ‰¿å…¨å±€æ¯ç‰ˆæ¨¡æ¿ -->

<!-- è¦†ç›–æ¯ç‰ˆcontentï¼Œå¡«å……è´­ç‰©è½¦å†…å®¹ -->
{% block content %}
<div class="col-12">

    <h2 class="fw-bold mb-4">æˆ‘çš„è´­ç‰©è½¦</h2> <!-- é¡µé¢æ ‡é¢˜ï¼Œç²—ä½“ï¼Œä¸‹æ–¹é—´è·4px -->

    {% if cart_items %}
    <!-- æœ‰å•†å“æ—¶çš„è´­ç‰©è½¦åˆ—è¡¨ -->
    <div class="card shadow-sm mb-4"> <!-- å¡ç‰‡æ ·å¼ï¼Œè½»å¾®é˜´å½±ï¼Œä¸‹æ–¹é—´è·4px -->
        <div class="table-responsive"> <!-- è¡¨æ ¼å“åº”å¼ï¼Œè¶…å‡ºæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡ -->
            <table class="table table-hover mb-0"> <!-- è¡¨æ ¼æ ·å¼ï¼Œé¼ æ ‡æ‚¬æµ®é«˜äº®ï¼Œæ— åº•éƒ¨å¤–è¾¹è· -->

                <thead class="table-light"> <!-- è¡¨å¤´æµ…ç°è‰²èƒŒæ™¯ -->
                    <tr>
                        <th width="40%">å•†å“ä¿¡æ¯</th> <!-- å•†å“ä¿¡æ¯åˆ—ï¼Œå 40%å®½åº¦ -->
                        <th width="15%">å•ä»·</th> <!-- å•ä»·åˆ—ï¼Œå 15%å®½åº¦ -->
                        <th width="20%">æ•°é‡</th> <!-- æ•°é‡åˆ—ï¼Œå 20%å®½åº¦ -->
                        <th width="15%">å°è®¡</th> <!-- å°è®¡åˆ—ï¼Œå 15%å®½åº¦ -->
                        <th width="10%">æ“ä½œ</th> <!-- æ“ä½œåˆ—ï¼Œå 10%å®½åº¦ -->
                    </tr>
                </thead>  
                
                <tbody>
                    {% for item in cart_items %}
                    <tr>

                        <!-- å•†å“ä¿¡æ¯åˆ—ï¼šåŒ…å«å›¾ç‰‡å’Œå•†å“åç§°/åˆ†ç±» -->
                        <td>
                            <div class="d-flex align-items-center"> <!-- å¼¹æ€§å¸ƒå±€ï¼Œå‚ç›´å±…ä¸­ -->
                                <img src="{% if item.product.images.first %}{{ item.product.images.first.image.url }}{% else %}https://via.placeholder.com/80x80{% endif %}"
                                    alt="{{ item.product.name }}" class="me-3" style="width: 80px; height: 80px; object-fit: cover; border-radius: 4px;">
                                <!-- å•†å“å›¾ç‰‡ï¼Œå³ä¾§é—´è·3pxï¼Œå›ºå®šå°ºå¯¸ï¼Œåœ†è§’ -->
                            <div>
                                <h6 class="mb-1">{{ item.product.name }}</h6> <!-- å•†å“åç§°ï¼Œä¸‹æ–¹é—´è·1px -->
                                <p class="text-muted small mb-0">{{ item.product.category.name }}</p>
                                    <!-- å•†å“åˆ†ç±»ï¼Œå°å·å­—ä½“ï¼Œæµ…ç°è‰² -->
                            </div>                            
                        </td>

                        <!-- å•ä»·åˆ—ï¼šæ˜¾ç¤ºå•†å“å•ä»·ï¼Œå‚ç›´å±…ä¸­ -->
                        <td class="align-middle">Â¥{{ item.product.price }}</td>

                        <!-- æ•°é‡æ›´æ–°åˆ—ï¼šè¡¨å•æäº¤ï¼Œå®ç°æ•°é‡ä¿®æ”¹ -->
                        <td class="align-middle">
                            <form method="post" action="{% url 'cart:update_cart_item' item.id %}" class="d-flex justify-content-center align-items-center">
                                {% csrf_token %} <!-- é˜²æ­¢CSRFæ”»å‡» -->
                                <!-- å‡å·æŒ‰é’®ï¼šç‚¹å‡»è§¦å‘æ•°é‡å‡1å‡½æ•°ï¼Œä¼ é€’è´­ç‰©è½¦é¡¹ID -->
                                <button type="button" class="btn btn-sm btn-outline-secondary me-1" onclick="decreaseItemQuantity({{ item.id }})">-</button>
                                <!-- æ•°é‡è¾“å…¥æ¡†ï¼šIDåŒ…å«è´­ç‰©è½¦é¡¹IDï¼Œç¡®ä¿å”¯ä¸€ï¼Œå±…ä¸­æ˜¾ç¤º -->
                                <input type="number" name="quantity" id="quantity-{{ item.id }}" 
                                       value="{{ item.quantity }}" min="1" max="{{ item.product.stock }}" 
                                       class="form-control form-control-sm text-center w-25" required>
                                <!-- åŠ å·æŒ‰é’®ï¼šç‚¹å‡»è§¦å‘æ•°é‡åŠ 1å‡½æ•°ï¼Œä¼ é€’è´­ç‰©è½¦é¡¹ID -->
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-1" onclick="increaseItemQuantity({{ item.id }})">+</button>
                                <!-- æ›´æ–°æŒ‰é’®ï¼šå°å·è“è‰²æŒ‰é’®ï¼Œå·¦ä¾§é—´è·2px -->
                                <button type="submit" class="btn btn-sm btn-primary ms-2">æ›´æ–°</button>
                            </form>
                        </td>


                        <!-- å°è®¡åˆ—ï¼šä½¿ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨mulï¼Œè®¡ç®—â€œæ•°é‡Ã—å•ä»·â€ï¼Œå‚ç›´å±…ä¸­ï¼Œç²—ä½“ -->
                        <td class="align-middle fw-bold">Â¥{{ item.quantity|mul:item.product.price }}</td>

                        <!-- æ“ä½œåˆ—ï¼šåˆ é™¤æŒ‰é’®ï¼Œç‚¹å‡»è·³è½¬è‡³ç§»é™¤å•†å“è·¯ç”±ï¼Œå¼¹å‡ºç¡®è®¤æç¤º -->
                        <td class="align-middle">
                            <a href="{% url 'cart:remove_from_cart' item.id %}" 
                               class="btn btn-sm btn-outline-danger" 
                               onclick="return confirm('ç¡®å®šè¦ç§»é™¤è¯¥å•†å“å—ï¼Ÿ')">
                                åˆ é™¤
                            </a>
                        </td>

                    </tr>     
                    {% {% endfor %} %} 
                </tbody>

            </table>
        </div>
    </div>

    <!-- è´­ç‰©è½¦åº•éƒ¨æ“ä½œæ ï¼šå·¦ä¾§æ¸…ç©ºè´­ç‰©è½¦ï¼Œå³ä¾§æ€»è®¡ä¸ç»“ç®— -->
    <div class="d-flex justify-content-between align-items-center mb-5">

        <!-- æ¸…ç©ºè´­ç‰©è½¦æŒ‰é’®ï¼šçº¢è‰²è¾¹æ¡†ï¼Œç‚¹å‡»å¼¹å‡ºç¡®è®¤æç¤º -->
        <a href="{% url 'cart:clear_cart' %}" class="btn btn-outline-danger" 
            onclick="return confirm('ç¡®å®šè¦æ¸…ç©ºè´­ç‰©è½¦å—ï¼Ÿæ‰€æœ‰å•†å“å°†è¢«ç§»é™¤ï¼')">
            <i class="bi bi-trash3"></i> æ¸…ç©ºè´­ç‰©è½¦ <!-- åƒåœ¾æ¡¶å›¾æ ‡+æ–‡å­— -->
        </a> 
        
        <!-- æ€»è®¡ä¸ç»“ç®—ï¼šå³å¯¹é½ -->
        <div class="text-right">
            <h4 class="fw-bold">
                è®¢å•æ€»è®¡ï¼š<span class="text-danger">Â¥{{ total_price }}</span>
                <!-- æ€»é‡‘é¢ï¼Œçº¢è‰²ç²—ä½“ -->
            </h4>

            <p class="text-muted mb-2">å·²åŒ…å«ç¨è´¹ï¼Œæ— é…é€è´¹</p> 
            
            <!-- è¾…åŠ©æ–‡æœ¬ï¼Œæµ…ç°è‰² -->
            <!-- å»ç»“ç®—æŒ‰é’®ï¼šå¤§å·è“è‰²æŒ‰é’®ï¼Œç‚¹å‡»è·³è½¬è‡³è®¢å•ç¡®è®¤é¡µ -->
            <a href="{% url 'cart:confirm_order' %}" class="btn btn-primary btn-lg">
                <i class="bi bi-credit-card"></i> å»ç»“ç®— <!-- ä¿¡ç”¨å¡å›¾æ ‡+æ–‡å­— -->
            </a> 
        </div> 
    </div>

    {% else %}
    <!-- æ— å•†å“æ—¶çš„ç©ºè´­ç‰©è½¦æç¤º -->
    <div class="card shadow-sm text-center py-5"> <!-- å¡ç‰‡æ ·å¼ï¼Œå±…ä¸­æ˜¾ç¤ºï¼Œä¸Šä¸‹å†…è¾¹è·5px -->
        <div class="card-body">

            <img src="https://via.placeholder.com/150x150?text=ğŸ›’" alt="ç©ºè´­ç‰©è½¦" class="mb-3">

            <!-- è´­ç‰©è½¦å›¾æ ‡ï¼Œä¸‹æ–¹é—´è·3px -->
            <h3 class="fw-bold mb-2">æ‚¨çš„è´­ç‰©è½¦æ˜¯ç©ºçš„</h3> <!-- ç²—ä½“æ ‡é¢˜ï¼Œä¸‹æ–¹é—´è·2px -->
            <p class="text-muted mb-4">å¿«å»æŒ‘é€‰å¿ƒä»ªçš„å•†å“å§~</p>

            <!-- æç¤ºæ–‡æœ¬ï¼Œæµ…ç°è‰²ï¼Œä¸‹æ–¹é—´è·4px -->
            <!-- å»è´­ç‰©æŒ‰é’®ï¼šå¤§å·è“è‰²æŒ‰é’®ï¼Œç‚¹å‡»è·³è½¬è‡³å•†å“åˆ—è¡¨é¡µ -->
            <a href="{% url 'products:product_list' %}" class="btn btn-primary btn-lg">
                <i class="bi bi-shop"></i> å»è´­ç‰© <!-- å•†åº—å›¾æ ‡+æ–‡å­— -->
            </a>

        </div>
    </div>
    {% endif %}
</div>
{% endblock %}


<!-- è¦†ç›–æ¯ç‰ˆextra_jsï¼Œæ·»åŠ è´­ç‰©è½¦é¡¹æ•°é‡è°ƒæ•´çš„JS -->
{% block extra_js %}
<script>
    // è´­ç‰©è½¦é¡¹æ•°é‡å‡1å‡½æ•°ï¼šæ ¹æ®è´­ç‰©è½¦é¡¹IDè·å–è¾“å…¥æ¡†ï¼Œå€¼å¤§äº1æ—¶å‡1
    function decreaseItemQuantity(itemId) {
        const input = document.getElementById(`quantity-${itemId}`); // æ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥ID
        let val = parseInt(input.value); // è½¬æ¢ä¸ºæ•´æ•°
        if (val > 1) {
            input.value = val - 1;
        }
    }

    // è´­ç‰©è½¦é¡¹æ•°é‡åŠ 1å‡½æ•°ï¼šæ ¹æ®è´­ç‰©è½¦é¡¹IDè·å–è¾“å…¥æ¡†ï¼Œå€¼å°äºåº“å­˜æ—¶åŠ 1
    function increaseItemQuantity(itemId) {
        const input = document.getElementById(`quantity-${itemId}`); // æ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥ID
        let val = parseInt(input.value); // è½¬æ¢ä¸ºæ•´æ•°
        const max = parseInt(input.max); // è·å–åº“å­˜æœ€å¤§å€¼
        if (val < max) {
            input.value = val + 1;
        }
    }
</script>
{% endblock %}